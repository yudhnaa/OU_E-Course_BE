<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<th:block layout:fragment="pagetitle">
    <div th:replace="~{partials/title-meta :: title-meta('Question Detail')}"></div>
</th:block>
<head>
    <link th:href="@{/assets/libs/sweetalert2/sweetalert2.min.css}" rel="stylesheet"/>
</head>
<body>
<div layout:fragment="content">
    <div th:replace="~{partials/page-title :: page-title('Edit Question','Lecturer')}"></div>

    <!-- Danger Alert -->
    <div class="alert alert-danger alert-dismissible fade show" role="alert"
         th:if="${msg_error}">
        <b th:text="${msg_error}">Dismissible danger Alert </b>
        <button type="button" class="btn-close" data-bs-dismiss="alert"
                aria-label="Close"></button>
    </div>

    <!-- Success Alert -->
    <div class="alert alert-success alert-dismissible fade show" role="alert"
         th:if="${msg_success}">
        <b th:text="${msg_success}"></b>
        <button type="button" class="btn-close" data-bs-dismiss="alert"
                aria-label="Close"></button>
    </div>

    <div class="container">
        <form th:action="@{'/course/' + ${courseId} + '/lessons/' + ${lessonId} + '/exercises/exercise/' + ${exerciseId} + '/question/' + ${questionId}}"
              th:object="${question}"
              method="post">
            <input type="hidden" name="id" th:value="*{id}"/>
            <input type="hidden" id="deletedAnswerIds" name="deletedAnswerIds"/>
            <div class="mb-3">
                <label class="form-label">Question Content</label>
                <textarea class="form-control" name="content" th:text="${question.content}" rows="4" required></textarea>
            </div>

            <div class="mb-3">
                <label class="form-label">Question Type</label>
                <input type="text" class="form-control" th:value="${question.questionTypeId.name}" disabled/>
                <input type="hidden" name="questionTypeId.id" th:value="${question.questionTypeId.id}"/>
            </div>

            <!-- Multiple Choice Questions -->
            <div th:if="${question.questionTypeId.id.equals(1)}">
                <div id="answers-container">
                    <div class="mb-3" th:each="answer, iterStat : ${answers}">
                        <div class="answer-item border p-2 mb-2 rounded">
                            <label class="form-label">Option [[${iterStat.index + 1}]]</label>
                            <input type="text" class="form-control mb-2" name="options" th:value="${answer.content}" required/>
                            <input type="hidden" name="answerIds" th:value="${answer.id}"/>

                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="correctOption"
                                       th:value="${iterStat.index}"
                                       th:checked="${answer.isCorrect}"/>
                                <label class="form-check-label">Mark as Correct</label>
                            </div>

                            <button type="button" class="btn btn-danger btn-sm remove-answer-btn">Remove</button>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-success btn-sm mt-2" onclick="addAnswer()">Add Option</button>
            </div>
            <!-- Writing Questions -->
            <div th:if="${question.questionTypeId.id.equals(2)}">
                <div class="mb-3">
                    <label class="form-label">Sample Answer</label>
                    <textarea class="form-control" name="sampleAnswer"
                              th:text="${answers != null ? answers.content : ''}"
                              rows="3"></textarea>
                    <input type="hidden" name="writingAnswerId" th:value="${answers != null ? answers.id : ''}"/>
                </div>
            </div>
            <div class="text-end">
                <button type="submit" class="btn btn-primary">Update Question</button>
                <a th:href="@{'/course/' + ${courseId} + '/lessons/' + ${lessonId} + '/exercises/exercise/' + ${exerciseId}}" class="btn btn-secondary">Back</a>
            </div>
        </form>
    </div>
</div>

<th:block layout:fragment="pagejs">
    <script src="/static/assets/js/question-detail.init.js"></script>
</th:block>

</body>
</html>