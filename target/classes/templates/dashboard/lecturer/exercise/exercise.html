<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<th:block layout:fragment="pagetitle" >
    <div th:replace="partials/title-meta :: title-meta('Test')"></div>
</th:block>
<head>

</head>
<body>
<div layout:fragment="content">
    <div th:replace="~{partials/page-title :: page-title('Exercise','Lecturer')}"></div>

    <!-- Danger Alert -->
    <div class="alert alert-danger alert-dismissible fade show" role="alert" th:if="${msg_error}">
        <b th:text="${msg_error}">Dismissible danger Alert </b>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Success Alert -->
    <div class="alert alert-success alert-dismissible fade show" role="alert" th:if="${msg_success}">
        <b th:text="${msg_success}"></b>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Hiển thị danh sách exercises -->
    <div th:each="exercise : ${exercises}" class="card mb-3">
        <h5 class="card-header" th:text="${exercise.name}">Exercise Name</h5>
        <div class="card-body">
            <h5 class="card-title">Exercise Details</h5>
            <p class="card-text">
                <i class="fa-solid fa-book"></i>
                <span th:text="'Course: ' + ${courseName}">
                    Course: Programming
                </span>
            </p>
            <p class="card-text">
                <i class="fa-solid fa-user"></i>
                <span th:text="'Created by: ' + ${lecturerNames[exercise.id]}">Created by: user</span>
            </p>
            <p class="card-text">
                <i class="fa-solid fa-clock"></i>
                <span th:text="'Duration: ' + ${exercise.durationMinutes} + ' minutes'">
                    Duration: 30 minutes
                </span>
            </p>
            <a th:href="@{/course/{courseId}/exercises/exercise/{exerciseId}(courseId=${courseId}, exerciseId=${exercise.id})}"
               class="btn btn-primary btn-label waves-effect right waves-light">
                <span>Detail</span>
                <i class="fa-solid fa-circle-info label-icon align-middle fs-16 ms-2"></i>
            </a>

            <!-- Form delete cho từng exercise -->
            <form th:id="'deleteForm-' + ${exercise.id}" method="post"
                  th:action="@{/course/{courseId}/exercises/exercise/{exerciseId}/delete(courseId=${courseId}, exerciseId=${exercise.id})}"
                  style="display: inline;">
                <button type="button"
                        class="btn btn-danger btn-label waves-effect right waves-light delete-exercise-btn"
                        th:data-exercise-id="${exercise.id}"
                        th:data-exercise-name="${exercise.name}">
                    <span>Delete</span>
                    <i class="fa-solid fa-trash label-icon align-middle fs-16 ms-2"></i>
                </button>
            </form>

        </div>
    </div>

    <div class = "col-sm-6">
        <ul class = "pagination pagination-separated justify-content-center justify-content-sm-end mb-sm-0">
            <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                <a th:href="@{/course/{courseId}/exercises(courseId=${courseId}, page=${currentPage - 1})}" class="page-link">
                    <i class="mdi mdi-chevron-left"></i>
                </a>
            </li>

            <li class="page-item" th:each="page : ${#numbers.sequence(1, totalPages)}" th:classappend="${page == currentPage} ? 'active'">
                <a th:href="@{/course/{courseId}/exercises(courseId=${courseId}, page=${page})}" class="page-link" th:text="${page}"></a>
            </li>

            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                <a th:href="@{/course/{courseId}/exercises(courseId=${courseId}, page=${currentPage + 1})}" class="page-link">
                    <i class="mdi mdi-chevron-right"></i>
                </a>
            </li>
        </ul>
    </div>
</div>

<th:block layout:fragment="pagejs">
    <script th:src="@{/assets/libs/sweetalert2/sweetalert2.min.js}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            console.log('Document ready');

            // Xử lý click event cho nút delete
            $('.delete-exercise-btn').on('click', function(e) {
                e.preventDefault();
                console.log('Delete button clicked');

                const exerciseId = $(this).data('exercise-id');
                const exerciseName = $(this).data('exercise-name');
                const deleteForm = $('#deleteForm-' + exerciseId);

                console.log('Exercise ID:', exerciseId, 'Exercise Name:', exerciseName);
                console.log('Form found:', deleteForm.length > 0);

                // Hiển thị SweetAlert để xác nhận
                Swal.fire({
                    title: 'Bạn có chắc chắn?',
                    html: `Bạn có muốn xóa bài tập "<strong>${exerciseName}</strong>" không?<br>Hành động này không thể hoàn tác!`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#6c757d',
                    confirmButtonText: 'Có, xóa đi!',
                    cancelButtonText: 'Hủy',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        console.log('User confirmed delete, submitting form');
                        deleteForm.submit();
                    }
                });
            });
        });
    </script>
</th:block>
</body>
</html>